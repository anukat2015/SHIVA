<!DOCTYPE html>
<html>
<head>
	<LINK REL="SHORTCUT ICON" HREF="UVALogo.ico">
	<title>SHIVA Data Viewer</title>
	<link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.8.16.custom.css">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
 	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
	<script type="text/javascript" src="SHIVA_Show.js"></script>
	<style type="text/css">
		body{ margin:8px; font-family:Verdana,Geneva,sans-serif; font-size:x-small;	}
		.h1 { font-size: larger; color: #666666; }
		p.pb { text-align:right; color:#999999; }
		.propTable { -moz-border-radius:8px;-webkit-border-radius:8px;-khtml-border-radius:80px;border-radius:8px;
				  	 background-color:#eee;border:1px solid #ccc;
				  	 background:-moz-linear-gradient(top,#f0f0f0,#dfdfdf);
				  	 background:-webkit-linear-gradient(top, #f0f0f0 0%, #dfdfdf 100%);
				  	 }
	</style>
</head>
<body>
	<div style="width:279px;position:absolute;top:0px;left:0px">
    <table id="propertyTable" class="propTable" cellspacing="0" cellpadding="0" width="278">
		<tr height='8'><td ></td></tr>
	</table> 
	<p align="right">Save as: 
		<select id='formatter' onChange='SaveData(this.value)'>
			<option>Choose format</option>
			<option>WordPress</option>
			<option>eStore</option>
			<option>iFrame</option>
			<option>JSON</option>
			<option>Web-page</option>
		</select> 
	</p>		
	<p align="right"><a href="#" onclick="sendTestMessage(); return false;" style="font-size: 120%;">Test Message</a></p>
 	<div id="helpDiv"/>
	</div>
	<div id="outputDiv" style="width:460px"></div>
	<div id="containerDiv" style="width:600px;height:400px;position:absolute;top:0px;left:308px"></div>
 
<script>


///////// GLOBALS   //////////
	var g;
	var chartType;
	var chartProp;
	var curAtt=null;
	var shivaCallBack=null;
	var shivaLib=null;
	var shivaGroup="Data"
	var items=new Array();

	var props={
		dataSourceUrl: 				{	def:'', 	opt:'string',			des:'Source of data'},
		title: 						{	def:'', 		opt:'string',		 des:'Title of data'}
		}
	
	var helpText=new Array();
	helpText['Source of data']="This is the url to the Google Docs spreadsheet";
	helpText['Title of data']="This is the title of the Google Docs spreadsheet";
	
///////// INIT  /////////////
	
	var myparent;

	$(document).ready(function() {
		shivaLib=new SHIVA_Show("containerDiv");
		$("#containerDiv").append('<iframe name="Gdoc_Frame" id="Gdoc_Frame" width="1000" height="2000" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>');
	  	SetAttributes(props);
		ReEdit();
		Draw();
		ShowHelp("startup");
		if (window.addEventListener) 
			window.addEventListener("message",shivaEventHandler,false);
		else
			window.attachEvent("message",shivaEventHandler);
	});

	function shivaEventHandler(e)
	{
		if(typeof(myparent) == "undefined") {
			myparent = e.source;
		}
		if (e.data.indexOf("GetJSON") == 0) 
			e.source.postMessage("GetJSON="+SaveData("GetJSON"),"*");
		else if (e.data.indexOf("GetType") == 0) 
			e.source.postMessage("GetType="+shivaGroup,"*");
		else if (e.data.indexOf("PutJSON") == 0) 
			ReEdit($.parseJSON(e.data.substr(8)));
		if (shivaLib.drupalMan)	shivaLib.drupalMan=e.source;
	}
 
	function Draw(mode)
	{
		var json = SaveData("GetJSON");
		var json = $.parseJSON(json);
		if(typeof(json) == "object" && typeof(json.dataSourceUrl) == "string" && json.dataSourceUrl != "") {
			$("#Gdoc_Frame").attr('src',json.dataSourceUrl + '&output=html&widget=true');
		}
	}

	function SaveData(mode)
	{
		return shivaLib.SaveData(mode,shivaGroup,null,props);
	}	

	function ReEdit(jsonData)
	{
		shivaLib.ReEdit(jsonData,props);
		Draw();
	}

	function ShowHelp(att)
	{
		if (shivaLib.player){
			if (shivaLib.player.getDuration) {
				var str=Math.floor(shivaLib.player.getDuration()/60)+":";
				str+=Math.ceil(shivaLib.player.getDuration()%60);	
				$("#propInput10").val(str);
				}
			}
		if (att == "startup") 
			$("#helpDiv").html("<br/><p class='pb'>Built by SHANTI<br/>The University of Virginia</p>");
		else
			shivaLib.ShowHelp(att,helpText);
	}	

	function SetAttributes()
	{
		shivaLib.SetAttributes(props);
	}	

	function trace(str) 
	{ 
		console.log(str) 
	}
	
	function sendTestMessage() {
		myparent.postMessage('GetDataSourceUrl',"*");
	}

</script>
</body></html>