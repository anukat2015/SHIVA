<!DOCTYPE html>
<html>
<head>
	<link REL="SHORTCUT ICON" HREF="UVALogo.ico">
	<title>SHIVA Idea Map</title>
	<link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.8.16.custom.css">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
	<script type="text/javascript" src="SHIVA_Show.js"></script>
	<style type="text/css">
		body { font-family:Verdana,Geneva,sans-serif; font-size:xx-small; }
		p.pb { text-align:right; color:#999999; }
		.rounded-corners { -moz-border-radius:8px;-webkit-border-radius:8px;-khtml-border-radius:80px;border-radius:8px;}
	</style>
</head>
	<div style="width:279px;position:absolute;top:0px;left:0px">
    <table id="propertyTable" bgcolor="#eeeeee" cellspacing="0" cellpadding="0" width="278">
		<tr height='8'><td align="center" colspan="5" background='frametop.png'></td></tr>
	</table> 
		<p align="right"><img src='annotate.gif' style='vertical-align:bottom' onclick='shivaLib.Annotate()'>&nbsp;&nbsp;&nbsp;Save as: 
		<select id='formatter' onChange='SaveData(this.value)'>
			<option>Choose format</option>
			<option>WordPress</option>
			<option>Canvas</option>
			<option>iFrame</option>
			<option>JSON</option>
			<option>Web-page</option>
		</select> 
	</p>		
 	<div id="helpDiv"/>
	</div>
	<div id="outputDiv" style="width:460px"></div>
	<div id="containerDiv" style="position:absolute;top:0px;left:308px"></div>
<script>

///////// GLOBALS   //////////

	var shivaLib=null;
	var cLib=null;
	var shivaGroup="Idea"
	
	var props={
		dataSourceUrl: 				{	def:'', 			opt:'string',			des:'URL of spreadsheet'}, 
		width: 						{	def:'800', 			opt:'number',			des:'Width of map'}, 
		height: 					{	def:'600', 			opt:'number',			des:'Height of map'}, 
		ue: 						{	def:'false', 		opt:'true|false',		des:'Enable user editing?'}, 
		ud: 						{	def:'false', 		opt:'true|false',		des:'Enable user draw?'} 
		}
	
	var helpText=new Array();
	$(document).ready(function() {
 		shivaLib=new SHIVA_Show("containerDiv");
		shivaLib.drupalMan=(""+window.location).match(/pr=d/);
	  	SetAttributes(props);
		cLib=new SHIVA_Idea("containerDiv");
		ReEdit();
		Draw();
		ShowHelp("startup");
		if (window.addEventListener) 
			window.addEventListener("message",shivaEventHandler,false);
		else
			window.attachEvent("message",shivaEventHandler);
	});

	function shivaEventHandler(e)
	{
		if (e.data.indexOf("GetJSON") == 0) 
			e.source.postMessage("GetJSON="+SaveData("GetJSON"),"*");
		else if (e.data.indexOf("GetWebPage") == 0) 
			e.source.postMessage("GetWebPage="+SaveData("Web-page"),"*");
		else if (e.data.indexOf("GetWordPress") == 0) 
			e.source.postMessage("GetWordPress="+SaveData("WordPress"),"*");
		else if (e.data.indexOf("GetType") == 0) 
			e.source.postMessage("GetType="+shivaGroup,"*");
		else if (e.data.indexOf("PutJSON") == 0) 
			ReEdit($.parseJSON(e.data.substr(8)));
	}
 
	function Draw(mode)
	{	
		shivaLib.Draw($.parseJSON(SaveData("GetJSON")));
	}

	function SaveData(mode)
	{
		return shivaLib.SaveData(mode,shivaGroup,null,props);
	}	

	function ReEdit(jsonData)
	{
		shivaLib.ReEdit(jsonData,props);
		Draw();
	}	

	function ShowHelp(att)
	{
		if (att == "startup") 
			$("#helpDiv").html("<br/><p class='pb'>Built by SHANTI<br/>The University of Virginia</p>");
		else
			shivaLib.ShowHelp(att,helpText);
	}	

	function SetAttributes()
	{
		shivaLib.SetAttributes(props);
	}	

	function trace(str) { console.log(str) };	
	
	
///////////////////////////////////////////////////////////////////////////////////////////////
//  SHIVA COCNEPT
///////////////////////////////////////////////////////////////////////////////////////////////

function SHIVA_Idea(container) 										// CONSTRUCTOR
{
	this.curTool=0;
	this.container=container;
	this.leftClick=false;												// Hold left button status
	this.lastX=0;		this.lastY=0;									// Last cursor mouse down
	shivaLib.cm=this;													// Set SHIVA_Show pointer
	this.DrawPalette();													// Draw palatte
	this.Draw();														// Draw
	this.ctx=$("#shivaIdeaCanvas")[0].getContext('2d');					// Get context
	$("#shivaIdeaDiv").css("cursor","crosshair");						// Crosshair cursor
	$("#shivaIdeaDiv").mouseup(this.onMouseUp);							// Mouseup listener
	$("#shivaIdeaDiv").mousedown(this.onMouseDown);						// Mouseup listener
	$("#shivaIdeaDiv").mousemove(this.onMouseMove);						// Mouseup listener
	document.onkeyup=this.onKeyUp;										// Keystroke listener
}

SHIVA_Idea.prototype.DrawPalette=function(tool) 						//	DRAW 
{
	var left=$("#"+this.container).css("left").replace(/px/g,"");		// Get left
	if ($("#shivaIdeaPaletteDiv").length == 0) {						// If no palette
		str="<div id='shivaIdeaPaletteDiv' style='position:absolute;left:60px;top:300px;width:158px;height:204px'>";
		$("body").append("</div>"+str);									// Add palette to body
		$("#shivaIdeaPaletteDiv").addClass("rounded-corners").css("background-color","#eee").css('border',"1px solid #ccc");
		$("#shivaIdeaPaletteDiv").draggable();							// Make it draggable
		$("#shivaIdeaPaletteDiv").css("z-index",2001);					// Force on top
		}
	this.DrawMenu();													// Draw menu
}

SHIVA_Idea.prototype.DrawMenu=function(tool) 							//	DRAW MENUM
{
	var str="<p style='text-shadow:1px 1px white' align='center'><b>SHIVA Idea Map</b></p>";
	str+="<img src='closedot.gif' style='position:absolute;left:142px;top:0px' onclick='shivaLib.dr.SetTool(-1)'/>";
	str+="<div class='rounded-corners' style='position:absolute;left:8px;top:30px;width:142px;height:146px;background:white;border:1px solid #ccc'>";
	str+="<p align='center' style='position:absolute;top:142px;width:142px'>Add new node <img valign='bottom' src='adddot.gif'></p>";

	$("#shivaIdeaPaletteDiv").html(str);	
	$("#sdtb"+(this.curTool+1)).attr("checked","checked");					// Check current tool button
	$("#drawToolbar").buttonset();
	$("#sdtb1").button({text: false, icons: { primary: "ui-icon-pencil"}});
	$("#sdtb2").button({text: false, icons: { primary: "ui-icon-radio-on"}});
	$("#sdtb3").button({text: false, icons: { primary: "ui-icon-circlesmall-plus"}});
	$("#sdtb4").button({text: true });
	$("#sdtb5").button({text: false, icons: { primary: "ui-icon-image"}});
	$("#sdtb6").button({text: false, icons: { primary: "ui-icon-arrowthick-1-nw"}}).css("width","100");
	this.SetMenuProperties();												// Set menu properties
}

SHIVA_Idea.prototype.SetMenuProperties=function() 					//	SET MENU PROPERTIES
{
}	
	
SHIVA_Idea.prototype.Draw=function() 								// DRAW
{
	var ctx,str;
	var con="#"+this.container;
	if (!this.g)														// If no graphics lib
		this.g=new SHIVA_Graphics();									// Allocate it
	if (!$("#shivaDrawCanvas").length) {								// No canvas yet	
		str="<div id='shivaIdeaDiv' style='position:absolute";			// Div
		str+=";width:"+$(con).css("width");								// Make div
		str+=";height:"+$(con).css("height");							// same
		str+=";top:"+$(con).css("top");									// as
		str+=";left:"+$(con).css("left")+"'/>";							// container div
		$('body').append(str);											// Add to dom								
		this.g.CreateCanvas("shivaIdeaCanvas","shivaIdeaDiv");			// Create canvas
		ctx=$("#shivaIdeaCanvas")[0].getContext('2d');					// Get context
		$("#shivaIdeaDiv").attr("width",$(con).css("width"));			// Wid
		$("#shivaIdeaDiv").attr("height",$(con).css("height"));			// Hgt
		$("#shivaIdeaDiv").attr("left",$(con).css("left"));				// L
		$("#shivaIdeaDiv").attr("top",$(con).css("top"));				// T
		}
	if (!ctx)															// If no context
		ctx=$("#shivaDrawCanvas")[0].getContext('2d');					// Get context
	ctx.clearRect(0,0,1600,1600);										// Clear canvas
}	
								
SHIVA_Idea.prototype.onKeyUp=function(e)							// KEY UP HANDLER
{
}
			
</script>
</body></html>



